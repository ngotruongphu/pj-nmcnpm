<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>ğŸ™ï¸ Free Voice â†’ Text â†’ Chat AI</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 40px auto; text-align: center; }
    textarea { width: 100%; height: 100px; margin-top: 10px; }
    .msg { background: #f1f1f1; padding: 10px; border-radius: 8px; margin: 10px 0; text-align: left; }
    .ai { background: #e0f7fa; }
  </style>
</head>
<body>
  <h2>ğŸ™ï¸ Voice to Text + Free AI Chat</h2>
  <button id="start">Start Talking</button>
  <button id="stop">Stop</button>
  <p id="status">Idle</p>

  <textarea id="input" placeholder="NÃ³i hoáº·c nháº­p gÃ¬ Ä‘Ã³..."></textarea><br>
  <button id="btnSend">Send to AI</button>

  <div id="chat"></div>

  <script>
    // --- Speech to Text ---
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.lang = "vi-VN";
    recognition.continuous = true;

    const input = document.getElementById("input");
    const status = document.getElementById("status");
    const chat = document.getElementById("chat");

    document.getElementById("start").onclick = () => { recognition.start(); status.textContent = "ğŸ™ï¸ Äang nghe..."; };
    document.getElementById("stop").onclick = () => { recognition.stop(); status.textContent = "ÄÃ£ dá»«ng."; };

    recognition.onresult = (event) => {
      let text = "";
      for (let i = event.resultIndex; i < event.results.length; i++) {
        text += event.results[i][0].transcript;
      }
      input.value = text.trim();
    };

    // --- Gá»­i Ä‘áº¿n server ---
    async function sendToAI(text) {
      const msgUser = document.createElement("div");
      msgUser.className = "msg user";
      msgUser.textContent = "ğŸ§‘: " + text;
      chat.appendChild(msgUser);

      const res = await fetch("http://localhost:3000/api/ai", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ inputs: text })
      });

      const data = await res.json();
      console.log(data);

      const reply = data.reply || "ğŸ¤– KhÃ´ng cÃ³ pháº£n há»“i.";
      const msgAI = document.createElement("div");
      msgAI.className = "msg ai";
      msgAI.textContent = "ğŸ¤–: " + reply;
      chat.appendChild(msgAI);

    }

    document.getElementById("btnSend").onclick = () => {
      const text = input.value.trim();
      if (text) sendToAI(text);
    };
  </script>
</body>
</html>
